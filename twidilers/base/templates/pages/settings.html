{% extends 'base.html' %}
{% block title %}Settings{% endblock %}
{% block content %}
{% set account = findAccount() %}
    <!-- A submenu that shows different settings -->
    <div id="acct-navbar">
        <button class="pf-mnu-btn" id="acct-dtl-btn" onclick="accountDetail()">Account Details</button>
        <button class="pf-mnu-btn" id="security-btn" onclick="securityDetail()">Security</button>
        <button class="pf-mnu-btn" id="privacy-btn" onclick="privacyDetail()">Privacy</button>

    </div>
    <style>
        .submit {
            margin: 0;
        }
        h3 {
            margin: 0 0 20px 0;
        }
    </style>        
    <!-- Div with account details -->

    <div id="acct-dtl-content">
        <div class="profile-div" id="auth-info">
            <img src="{{ url_for('.get_pfp',username=account.username) }}" id="pfp">
            <section class="profile-auth">
                <h1 name="prof-username" id="display-name">{{account.displayname}}</h1>
                <h3 name="prof-username" id="prof-usrname">@{{account.username}}</h3>
            </section>
        </div>

        <div class="profile-div">
            <form method="post" id="change-name-change">
                <h3>Change display name</h3>
                <input id="change-name" name="change-name" type="text" class="textbox" autocomplete="off" autocapitalize="off" maxlength="24" placeholder="1-24 characters">
                <button class="submit" id="name-change" name="name-change">Change Name</button>
            </form>
        </div>
        <div class="profile-div">
            <h3>Upload profile picture</h3>
            <form method="post" enctype="multipart/form-data" id="upload_pfp">
                <label for="file" class="custom-file-upload">
                    choose picture
                </label>
                <input type="file" id="file" name="file" accept="image/*">
            </form>
        </div>
        <div class="profile-div">
            <a href="{{ url_for('.logout') }}"><button class="submit">Log out</button></a>
        </div>        
    </div>
    <div id="security-content">
        <div class="profile-div">
            <form method="post" id="change-password-change">
                <h3 class="div-heading">Change password</h3>
                <input id="old-password" name="old-password" type="text" class="textbox" autocomplete="off" autocapitalize="off" maxlength="24" placeholder="Current Password">
                <input id="new-password" name="new-password" type="text" class="textbox" autocomplete="off" autocapitalize="off" maxlength="24" placeholder="New Password"><br>
                <button class="submit" id="password-change" name="password-change">Change Password</button>
            </form>
        </div>
        <div class="profile-div">
            <form id="delete-account" name="delete-account" method="post">
                <button class="submit" id="delete" name="delete" onclick="checkDelete(event)">Delete Account</button>
            </form> 
        </div>
    </div>
    <div id="privacy-content">
        <div class="profile-div">
            <h3>Profile page visibility</h3>
            <button class="submit">Visable to everyone</button>
        </div>
    </div>
        <script>
            // This script hides/shows divs if menu bars are clicked.
            
            // It fetches the IDs of the divs so it can hide them
            const accountInfo = document.getElementById('acct-dtl-content');
            const security = document.getElementById('security-content');
            const privacy = document.getElementById('privacy-content');

            // it finds the buttons so we can make them bold when they're selected
            const securityButton = document.getElementById('security-btn');
            const privacyButton = document.getElementById('privacy-btn');
            const accountInfoButton = document.getElementById('acct-dtl-btn');

            // I don't have to type out the style stuff. It cleans everything up
            function makeBold(e){
                e.style.fontWeight = 'bold';
            }
            function makeNormal(e) {
                e.style.fontWeight = 'normal';
            }
            function showDiv(e) {
                e.style.display = 'block'
            }
            function hideDiv(e) {
                e.style.display = 'none';
            }
            // When the account button is clicked, it hides the other 
            // divs and shows the acct div. 
            function accountDetail() {
                showDiv(accountInfo);
                hideDiv(security);
                hideDiv(privacy);
                // It unbolds the other buttons and bolds the account button
                makeBold(accountInfoButton);
                makeNormal(privacyButton);
                makeNormal(securityButton);
            }

            // same for these functions just for their respoective elements
            function securityDetail() {
                hideDiv(accountInfo);
                showDiv(security);
                hideDiv(privacy);
                makeNormal(accountInfoButton);
                makeNormal(privacyButton);
                makeBold(securityButton);
            }
            function privacyDetail() {
                hideDiv(accountInfo);
                hideDiv(security);
                showDiv(privacy);
                makeNormal(accountInfoButton);
                makeBold(privacyButton);
                makeNormal(securityButton);
            }
            // This script promts an 'Are you sure?' textbox when clicking the button to delete your account
                function checkDelete(event) {
                event.preventDefault()
                if (confirm('Are you sure you want to delete your account?') == true) {
                    const hiddenInput = document.createElement('input'); //creates a hidden input so 'delete' is still in request.form (using submit() removes it for some reason)
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'delete';
                    document.getElementById('delete-account').appendChild(hiddenInput);
                    document.getElementById('delete-account').submit()
                }
            }

            // Submits the image when uploading a profile picture
            file = document.getElementById('file');
            file.addEventListener('change',() => {
                if(file.files.length > 0){
                    document.getElementById('upload_pfp').submit();
                }
            })</script>

           

{% endblock %}