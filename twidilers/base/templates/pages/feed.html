{% extends 'base.html' %}
{% block title %}Feed{% endblock %}
{% block head %}
<link rel="stylesheet"data-turbo-track="dynamic" href="{{ url_for('.static', filename='styles/post.css') }}">
<link rel="stylesheet"data-turbo-track="dynamic" href="{{ url_for('.static', filename='styles/toggle.css') }}">

{% endblock %}
{% block content %}
<div id="topfeed">
    <h1 id="feedtitle">Your feed</h1>
    <a href="{{ url_for('.write_post') }}"><button class="submit" id="createpost">Create a Post</button></a>
    <button id="filter" onclick="flyOut('filter-form','filter')"><i class="fa-solid fa-filter"></i></button>
    <form method="post" id="filter-form" name="filter-form">
        {% if session['filter'] == 1 %}
        <label class="switch">
            <input type="checkbox" id="filter-foll" name="filter-foll" checked></input>
            <span class="slider round"></span>
        </label>
        {% else %}
        <label class="switch">
            <input type="checkbox" id="filter-foll" name="filter-foll"></input>
            <span class="slider round"></span>
        </label>
        {% endif %}
        <p class="checkbox-label">Show only posts from people I follow</p>
        <button id="submit-filter">Submit</button>
    </form>
</div>
<script src="{{ url_for('.static', filename='/javascript/flyout.js') }}">
</script>
{% if postlist() | length > 0 %}
{% set account = findAccount() %}
{% for post in postlist() %}
{% if session['filter'] == 0 or post.author in account.following %}
<div class="pst">
    <!-- Post author and profile picture -->
    <a href="{{ url_for('.profile',username=post.author.username) }}">
        <div class="auth-info">
            <img class="pst-auth-pfp" loading="lazy" src="{{ url_for('.get_pfp', username=post.author.username) }}">
            <section class="pst-auths">
                <p class="pst-auth">{{post.author.displayname}}</p>
                <p class="pst-disp">@{{post.author.username}}</p>              
            </section>
        </div>
    </a>
    <!-- Interactions go here. Not coded yet -->
    <div class="reactions">
        <div class="like">
            <!--<i class="fa-solid fa-thumbs-up"></i>-->
        </div>
        {% if owner == 1 %}
            <a id="edit-post"><i class="fa-solid fa-pencil"></i></a>
        {% endif %}
    </div>
    <!-- Post content -->
    <h2 class="pst-title">{{post.title}}</h3>
        <p class="pst-content">{{post.content}}</p>
        <p class="pst-date" id="date{{ loop.index0 }}">date</p>
        <script>
            const date{{ loop.index0 }} = new Date({{ post.date.timestamp()*1000 }})
                document.getElementById("date{{ loop.index0 }}").innerHTML = date{{ loop.index0 }}.toLocaleString();
        </script>
</div>
{% endif %}
{% endfor %}

{% else %}
<h2>Nothing here yet...</h2>
{% endif %}
{% endblock %}