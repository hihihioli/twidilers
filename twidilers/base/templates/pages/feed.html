{% extends 'base.html' %}
{% block title %}Feed{% endblock %}
{% block head %}
<link rel="stylesheet" data-turbo-track="dynamic" href="{{ url_for('.static', filename='styles/post.css') }}">
<link rel="stylesheet" data-turbo-track="dynamic" href="{{ url_for('.static', filename='styles/toggle.css') }}">
{% endblock %}

{% block content %}
<main>
    <script>

        </script>

    <div id="topfeed" role="region" aria-label="Feed controls">
        <h1 id="feedtitle">Your feed</h1>
        <a href="{{ url_for('.write_post') }}" role="button" class="submit" id="createpost" aria-label="Create a new post">Create a Post</a>
        
        <button id="filter" 
                onclick="flyOut('filter-form','filter')" 
                aria-expanded="false"
                aria-controls="filter-form"
                aria-label="Toggle feed filters">
            <i class="fa-solid fa-filter" aria-hidden="true"></i>
            <span class="visually-hidden">Filter posts</span>
        </button>
 
        <form method="post" id="filter-form" name="filter-form" aria-label="Feed filter options">
            <div class="filter-control">
                <label class="switch" for="filter-foll">
                    <input type="checkbox" 
                           id="filter-foll" 
                           name="filter-foll" 
                           {% if session['filter'] == 1 %}checked{% endif %}
                           aria-label="Show only followed users">
                    <span class="slider round" aria-hidden="true"></span>
                </label>
                <span class="checkbox-label">Show only posts from people I follow</span>
            </div>
            <button id="submit-filter" type="submit" class="submit">Apply Filters</button>
        </form>
        <form method="post" id="refreshbutton" name="refreshbutton" aria-label="Refresh feed">
            <button id="refresh" type="button" onclick="getData()" class="submit">Refresh</button>
        </form>
    </div>
    <section aria-label="Posts feed" class="posts-container" id="post-container">
        {% set account = findAccount() %}
        {% for post in postlist() %}
            {% if session['filter'] == 0 or post.author in account.following or post.author == account %}
            <article class="pst" aria-labelledby="post-title-{{ loop.index }}" id="post{{ loop.index }}">
                <header>

                </header>
                <h2 class="pst-title" id="post-title-{{ loop.index }}">{{post.title}}</h2>
                <p class="pst-content">{{post.content}}</p>
                <p class="pst-date" id="date{{ loop.index0 }}">{{ loop.index0 }}</p>
                
            </article>
        {% endif %}
    {% endfor %}
        <script src="{{ url_for('.static', filename='/javascript/feed.js') }}">
        </script>
    </section>
    {% else %}
    <p class="no-posts">No posts to display</p>
    {% endif %}
</main>
<script src="{{ url_for('.static', filename='/javascript/flyout.js') }}">
</script>
{% endblock %}